options 
{
	LOOKAHEAD=1; 
	IGNORE_CASE=true;
	STATIC = false;
	
}
   

PARSER_BEGIN(Robot)

package uniandes.lym.robot.control;

import uniandes.lym.robot.kernel.*;
import java.awt.Point;
import java.io.*;
import java.util.Vector;
import java.util.LinkedList;

@SuppressWarnings("serial")
public class Robot 
{

	private RobotWorldDec world;
	
	void setWorld(RobotWorld w) {
		world = (RobotWorldDec) w;	
	}

	String salida=new String();
}
PARSER_END(Robot)

SKIP:
{
	" "
	|	"\r"
	|	"\t"
	| 	"\n"
}

TOKEN: /* Nombres de Comandos */
{
			< T_MOVE:  "move" >
		| 	< T_TURNRIGHT: "turnright" >
		| 	< T_PUT: "put" >
		| 	< T_PICK: "pick" >
		|   < T_POP: "pop" >
		| 	< T_SKIP: "skip" >
		| 	< IF: "if" >
		| 	< LOOP: "loop" >
		| 	< REPEAT: "repeat" >
		|	< NOT: "not" >
		| 	< DEFVAR: "defvar" >
		| 	< DEFUN: "defun" >
		| 	< TURN: "turn" >
		| 	< FACE: "face" >
		| 	< MOVE_DIR: "move-dir" >
		| 	< RUN_DIRS: "run-dirs" >
		| 	< MOVE_FACE: "move_face" >
		| 	< TURN_TO: "left" | "right" | "around" >
		| 	< FACE_TO: "north" | "east" | "south" | "west" >
		|	< DIR: "front" | "right" | "left" | "back" >
}

TOKEN:
{
			< T_BALLOONS: "ballons" >
		|	< T_CHIPS: "chips" >
}

TOKEN:
{
			< NUMERO: (<DIGIT>)+ >
		| 	< WORD: (< LETTER >)+ >
		|  	< #DIGIT: ["0"-"9"] >
		| 	< #LETTER: ["a"-"z"] >
}

	boolean inicio(StringBuffer sistema):
	{
	  salida = new String();
	}
	{
	  (
	    "(" (command() | instruction())+ ")"
	  | 
	  )

	{
	  sistema.append(salida);
	  return true;
	}
	
	|	<EOF> {return false;}
	
	}

	void command():
	{
	  int x;
	}
	{
	  (
	    < T_MOVE > x=numero() {world.moveForward(x);salida = "Command: Moveforward";}
	  | < T_TURNRIGHT > "(" ")" {world.turnRight();salida = "Command: Turnright";}
	  | < T_POP > "(" x=numero() ")" {world.popBalloons(x); salida = "Command: Pop";}
	  | < T_PUT > ":"  put()
	  | < T_PICK > ":"  pick()
	  )
	}

	void instruction() :
	{}
	{
	  (
	    < DEFVAR > < WORD > < NUMERO >
	  | < TURN > ":" < TURN_TO >
	  | < FACE > ":" < FACE_TO >
	  | < MOVE_DIR > ":" < DIR >
	  | < RUN_DIRS > ":" (< DIR >)+
	  | < MOVE_FACE > < NUMERO > ":" < FACE_TO >
	  | < T_SKIP >
	  )	} 
	  
	void put() :
	{
		int f=1;	
	}
	{
	  (
	    ( <T_CHIPS> f=numero() {world.putChips(f); salida = "Command:  Put Chips"; })
	  | ( <T_BALLOONS> f=numero() {world.putBalloons(f); salida = "Command:  Put Balloons";})	  )
	}

	void pick():
	{
		int f=1;	
	}
	{
	  (
	    ( <T_CHIPS> f=numero() {world.pickChips(f);salida = "Command:  Pick chips";})
	  | ( <T_BALLOONS> f=numero() {world.grabBalloons(f);salida="Command:  Pick balloons";})
	  )
	}

	/**
	 *  reconoce un numero entero sin signo
	 * @return el valor entero correspondiente al valor reconocido
	 */

	int numero() throws Error:
	{	
		int total=1;
	}
	{
		<NUMERO>
		{
			try 
			{
				total = Integer.parseInt(token.image);
			} 
			catch (NumberFormatException ee) 
			{
				// Dada la forma de NUMERO, sabemos que solo puede tener dï¿½gitos
				// Por lo tanto, lo unico que podria pasar es que el numero sea muy grande
				throw new Error("Number out of bounds: " + token.image + "!!");
			}
			return total;
		}
	}

	